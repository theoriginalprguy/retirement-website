<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>David's Desert Life â€“ Gallery</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="styles.css">
    <!-- Font Awesome for social media icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Netlify Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    
    <style>
      .gallery-item img {
        width: 100%;
        height: 220px;
        object-fit: cover;
      }
    </style>
  </head>
  <body>
    <div class="nav-blur"></div>
    
    <!-- Header placeholder -->
    <div id="header-placeholder"></div>
    
    <main>
      <div class="page-kicker">Desert life</div>
      <h1>Scenes from this chapter.</h1>
      <p class="lede">
        Add photos through the admin panel to populate this gallery.
      </p>
      <section class="gallery-grid" id="gallery"></section>
    </main>
    
    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
      <div class="lightbox-inner">
        <div class="lightbox-image-wrapper">
          <img src="" alt="" id="lightboxImage">
        </div>
        <div class="lightbox-meta">
          <div>
            <div class="lightbox-title" id="lightboxTitle"></div>
            <div id="lightboxDescription"></div>
          </div>
          <button class="lightbox-close" id="lightboxClose">Close</button>
        </div>
      </div>
    </div>
    
    <!-- Footer placeholder -->
    <div id="footer-placeholder"></div>
    
    <script>
      // Fetch all gallery items from _gallery folder
      async function loadGallery() {
        const gallery = document.getElementById('gallery');
        
        try {
          // This will need to fetch the gallery JSON files
          // For now, we'll use a simple fetch approach
          const response = await fetch('gallery-data.json');
          const photos = await response.json();
          
          photos.forEach(photo => {
            const figure = document.createElement("figure");
            figure.className = "gallery-item";
            figure.setAttribute("data-full", photo.image);
            figure.setAttribute("data-title", photo.title);
            figure.setAttribute("data-description", photo.description || "");

            figure.innerHTML = `
              <img src="${photo.image}" alt="${photo.title}">
              <figcaption class="gallery-caption">${photo.caption || photo.title}</figcaption>
              <span class="gallery-tag">Photo</span>
            `;

            gallery.appendChild(figure);
          });
        } catch (error) {
          console.log('Gallery data not yet available');
          gallery.innerHTML = '<p>No photos yet. Add photos through the admin panel.</p>';
        }
      }

      loadGallery();

      // LIGHTBOX CODE
      const lightbox = document.getElementById('lightbox');
      const lightboxImage = document.getElementById('lightboxImage');
      const lightboxTitle = document.getElementById('lightboxTitle');
      const lightboxDescription = document.getElementById('lightboxDescription');
      const lightboxClose = document.getElementById('lightboxClose');

      document.getElementById('gallery').addEventListener('click', function (e) {
        const figure = e.target.closest('.gallery-item');
        if (!figure) return;

        lightboxImage.src = figure.getAttribute('data-full');
        lightboxTitle.textContent = figure.getAttribute('data-title');
        lightboxDescription.textContent = figure.getAttribute('data-description');

        lightbox.classList.add('open');
      });

      function closeLightbox() {
        lightbox.classList.remove('open');
        lightboxImage.src = '';
      }

      lightboxClose.addEventListener('click', closeLightbox);

      lightbox.addEventListener('click', function (e) {
        if (e.target === lightbox) closeLightbox();
      });

      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && lightbox.classList.contains('open')) closeLightbox();
      });
    </script>
    
    <!-- Load shared header and footer -->
    <script src="shared.js"></script>
  </body>
</html>